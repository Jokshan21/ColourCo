<script>
  let voices = [];
  let utterance;
  let selectedLang = 'en'; // Default to English

  function loadVoices() {
    voices = speechSynthesis.getVoices();
    if (voices.length > 0) {
      document.getElementById("readButton").disabled = false;
    } else {
      setTimeout(loadVoices, 100);
    }
  }

  speechSynthesis.onvoiceschanged = loadVoices;
  loadVoices();

  function setLanguage(langCode) {
    selectedLang = langCode;
    stopReading(); // Stop if reading
  }

  function readText() {
    stopReading();

    const heading = document.getElementById('headingText').innerText;
    const body = document.getElementById('bodyText').innerText;
    const fullText = heading + ". ... " + body;

    utterance = new SpeechSynthesisUtterance(fullText);
    utterance.rate = 0.9;

    const voiceForLang = voices.find(voice => voice.lang.startsWith(selectedLang));
    if (voiceForLang) {
      utterance.voice = voiceForLang;
    }

    speechSynthesis.speak(utterance);
  }

  function pauseReading() {
    if (speechSynthesis.speaking && !speechSynthesis.paused) {
      speechSynthesis.pause();
    }
  }

  function resumeReading() {
    if (speechSynthesis.paused) {
      speechSynthesis.resume();
    }
  }

  function stopReading() {
    speechSynthesis.cancel();
  }
</script>
